<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fire Cause Data Test</title>
</head>
<body>
    <h1>Fire Cause Data Test</h1>
    <button onclick="testFireCauseData()">Test Fire Cause Integration</button>
    <div id="results"></div>

    <script src="utils.js"></script>
    <script src="fireDataManager.js"></script>
    
    <script>
        async function testFireCauseData() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Loading data...</p>';
            
            try {
                // Load sample fire data
                const activeFiresResponse = await fetch('active_fires.geojson');
                const activeFiresData = await activeFiresResponse.json();
                
                // Load ERD fire locations data
                const erdLocationsResponse = await fetch('erd_fire_locations.geojson');
                const erdLocationsData = await erdLocationsResponse.json();
                
                // Test the joining logic
                let joinedCount = 0;
                let totalFires = activeFiresData.features.length;
                let results = [];
                
                activeFiresData.features.slice(0, 10).forEach(fire => {
                    const fireProps = fire.properties;
                    const objectId = fireProps.OBJECTID;
                    
                    // Find matching ERD location data
                    const matchingLocation = erdLocationsData.features.find(location => 
                        location.properties.FIELD_AGENCY_FIRE_ID === objectId
                    );
                    
                    if (matchingLocation) {
                        joinedCount++;
                        results.push({
                            fireId: objectId,
                            fireName: fireProps.FIRE_NAME || 'Unnamed',
                            fireNumber: fireProps.FIRE_NUMBER_SHORT || fireProps.FIRE_NUMBER,
                            cause: matchingLocation.properties.FIELD_AGENCY_FIRE_CAUSE
                        });
                    } else {
                        results.push({
                            fireId: objectId,
                            fireName: fireProps.FIRE_NAME || 'Unnamed',
                            fireNumber: fireProps.FIRE_NUMBER_SHORT || fireProps.FIRE_NUMBER,
                            cause: 'No cause data found'
                        });
                    }
                });
                
                // Display results
                let html = `
                    <h2>Test Results</h2>
                    <p><strong>Total active fires tested:</strong> ${results.length}</p>
                    <p><strong>Fires with cause data:</strong> ${joinedCount}</p>
                    <p><strong>Join success rate:</strong> ${((joinedCount / results.length) * 100).toFixed(1)}%</p>
                    <h3>Sample Fire Data with Causes:</h3>
                    <table border="1" style="border-collapse: collapse; width: 100%;">
                        <tr>
                            <th>Fire ID</th>
                            <th>Fire Name</th>
                            <th>Fire Number</th>
                            <th>Cause</th>
                        </tr>
                `;
                
                results.forEach(result => {
                    html += `
                        <tr>
                            <td>${result.fireId}</td>
                            <td>${result.fireName}</td>
                            <td>${result.fireNumber}</td>
                            <td>${result.cause}</td>
                        </tr>
                    `;
                });
                
                html += '</table>';
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('Test failed:', error);
            }
        }
    </script>
</body>
</html>